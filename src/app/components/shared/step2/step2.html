<div class="wizard">
  <aside class="sidebar">
    <ul>
      @for (section of schema.sections; track section.id; let i = $index) {
        <li
          [class.active]="activeSection() === i"
          (click)="activeSection.set(i)"
        >
          {{ section.title }}
        </li>
      }
    </ul>
  </aside>

  <section>
    @let current = schema.sections[activeSection()];
    @let f = form();

    <h2>{{ current.title }}</h2>

    <form [formGroup]="f" (ngSubmit)="submitForm()">
      @for (field of current.fields; track field.id) {
        <div
          class="card"
          [class.error]="f.get(field.id.toString())?.invalid && f.get(field.id.toString())?.touched"
        >
          <label [for]="field.id">{{ field.label }}</label>

          @switch (field.type) {
            @case ('text') {
              <input
                [id]="field.id"
                type="text"
                [formControlName]="field.id.toString()"
              />
            }
            @case ('number') {
              <input
                [id]="field.id"
                type="number"
                [formControlName]="field.id.toString()"
              />
            }
            @case ('textarea') {
              <textarea [formControlName]="field.id.toString()"></textarea>
            }
            @case ('radio') {
              <div class="radio-group">
                @for (option of field.options; track option) {
                  <label>
                    <input
                      type="radio"
                      [formControlName]="field.id.toString()"
                      [value]="option"
                    />
                    <span>{{ option }}</span>
                  </label>
                }
              </div>
            }
            @case ('select') {
              <div class="dropdown-group">
                <select [formControlName]="field.id.toString()">
                  <option value="">Select</option>
                  @for (option of field.options; track option) {
                    <option [value]="option">{{ option }}</option>
                  }
                </select>
              </div>
            }
            @case ('toggle') {
              <label class="switch">
                <input type="checkbox" [formControlName]="field.id.toString()" />
                <span class="slider"></span>
              </label>
            }
          }

          @if (f.get(field.id.toString())?.invalid && f.get(field.id.toString())?.touched) {
            <p class="error-text">Required field!</p>
          }
        </div>
      }
    </form>

    <div class="save-state">
      @switch (saveState()) {
        @case ('saving') { <span>üíæ Saving...</span> }
        @case ('saved') { <span>‚úÖ Saved!</span> }
        @case ('error') { <span>‚ö†Ô∏è Error saving, trying again...</span> }
      }
    </div>

<div class="actions">
  @if (activeSection() === schema.sections.length - 1) {
    <button class="previous" type="button" (click)="prevSectionClick()">
      Previous
    </button>
  }

  <button
    class="primary"
    type="button"
    (click)="
      activeSection() === schema.sections.length - 1
        ? submitForm()
        : nextSectionClick()
    "
  >
    {{ activeSection() === schema.sections.length - 1 ? 'Submit' : 'Next' }}
  </button>
</div>
  </section>
</div>
